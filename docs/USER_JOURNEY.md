# User Journey - Knowledge Graph Platform

Документ описывает пути пользователей платформы для визуализации и управления графом знаний в области альтернативной физики и теорий эфира.

## Содержание

- [Роли пользователей](#роли-пользователей)
- [Основные сценарии использования](#основные-сценарии-использования)
- [User Journeys](#user-journeys)
- [Структура страниц](#структура-страниц)
- [Навигация и UX паттерны](#навигация-и-ux-паттерны)
- [Приоритеты разработки](#приоритеты-разработки)

---

## Роли пользователей

### 1. Анонимный посетитель (Guest)
**Возможности:**
- ✅ Просмотр опубликованных узлов и доменов
- ✅ Навигация по графу знаний (только публичные данные)
- ✅ Поиск по теориям, экспериментам, концепциям
- ✅ Чтение комментариев (Disqus)
- ❌ Создание и редактирование контента
- ❌ Добавление комментариев (требуется регистрация через Disqus)

**Мотивация:** Быстро найти информацию о теории/эксперименте, понять связи между концепциями.

### 2. Зарегистрированный пользователь (User)
**Возможности:**
- ✅ Все возможности Guest
- ✅ Создание собственных узлов (теории, эксперименты, концепции)
- ✅ Создание связей между узлами
- ✅ Создание собственных доменов
- ✅ Управление своими доменами (редактирование, удаление)
- ✅ Оценка узлов (rating system)
- ✅ Комментирование через Disqus
- ❌ Редактирование чужих узлов/доменов

**Мотивация:** Представить собственную теорию, связать концепции, построить альтернативное объяснение.

### 3. Соавтор домена (Domain Collaborator)
**Возможности:**
- ✅ Все возможности User
- ✅ Редактирование узлов в разрешенных доменах
- ✅ Создание связей в рамках домена
- ✅ Управление типами узлов и связей домена
- ❌ Удаление домена
- ❌ Управление правами доступа

**Мотивация:** Совместная работа над доменом знаний с владельцем.

### 4. Владелец домена (Domain Owner)
**Возможности:**
- ✅ Все возможности Collaborator
- ✅ Управление правами доступа к домену
- ✅ Приглашение соавторов
- ✅ Настройка внешнего вида домена (иконки, цвета)
- ✅ Удаление домена
- ❌ Управление другими доменами

**Мотивация:** Построить структурированную базу знаний по своей теме, привлечь соавторов.

### 5. Администратор (Admin)
**Возможности:**
- ✅ Все возможности всех ролей
- ✅ Управление всеми доменами
- ✅ Модерация контента
- ✅ Управление пользователями
- ✅ Управление глобальными настройками
- ✅ Доступ к аналитике и статистике

**Мотивация:** Поддержка качества контента, модерация, развитие платформы.

---

## Основные сценарии использования

### Сценарий 1: Исследование теории (Guest/User)

**Цель:** Найти информацию о квантовой механике и понять её связи с другими теориями.

**Шаги:**
1. Пользователь открывает главную страницу
2. Использует поиск: "квантовая механика"
3. Видит карточки релевантных узлов с превью
4. Открывает узел "Квантовая механика - основы"
5. Читает содержимое (EditorJS контент)
6. Видит визуализацию графа связей узла:
   - **Исходящие связи (outgoing):**
     - "Поддерживается" → "Эксперимент с двумя щелями"
     - "Поддерживается" → "Эффект квантовой запутанности"
   - **Входящие связи (incoming):**
     - "Выводится из" ← "Постулаты Бора"
     - "Противоречит" ← "Теория скрытых параметров"
7. Кликает на связь "Противоречит" → открывается альтернативная теория
8. Исследует дальше по графу
9. Прокручивает вниз - видит секцию комментариев (Disqus)
10. Читает обсуждение теории

**Ключевые экраны:**
- Главная страница с поиском
- Страница узла с графом связей
- Граф-визуализация (интерактивная)

---

### Сценарий 2: Открытие детального описания эффекта (Guest/User)

**Цель:** Человек услышал про "эффект Доплера в эфире" и хочет узнать подробнее.

**Шаги:**
1. Переходит по прямой ссылке или через поиск
2. Открывается страница узла с типом "Эксперимент"
3. Видит:
   - Заголовок и обложку
   - Метаданные: тип (Эксперимент), домен (Эфирная физика), теги
   - Содержимое с форматированием (заголовки, параграфы, изображения, формулы)
   - Рейтинги: coherence, consistency, connectivity
   - Граф связей
   - Секция "Связанные узлы" (похожие эксперименты)
4. Листает вниз - видит комментарии
5. Если заинтересовался - может зарегистрироваться

**Особенности:**
- SEO-оптимизация (мета-теги, Open Graph)
- Кнопка "Поделиться" (социальные сети)
- Breadcrumbs: Домен → Тип узла → Узел

---

### Сценарий 3: Создание собственной теории (User)

**Цель:** Пользователь хочет предложить альтернативное объяснение гравитации через эфир.

**Шаги:**
1. Авторизуется через Google OAuth
2. Переходит в раздел "Мои домены" или выбирает существующий домен "Эфирная физика"
3. Нажимает "Создать узел" → выбирает тип "Теория"
4. Заполняет форму:
   - Заголовок: "Гравитация как результат градиента плотности эфира"
   - Slug: auto-generated или ручной
   - Тип узла: Теория
   - Домен: Эфирная физика
   - Содержимое: EditorJS редактор
     - Вставляет заголовки, параграфы
     - Добавляет изображения (диаграммы)
     - Вставляет формулы (LaTeX через плагин)
   - Теги: гравитация, эфир, теория
   - Обложка: загружает изображение
5. Сохраняет как черновик
6. Предпросмотр → проверяет
7. Публикует (статус: published)
8. Переходит к созданию связей

**Ключевые экраны:**
- Dashboard пользователя
- Форма создания/редактирования узла с EditorJS
- Предпросмотр узла

---

### Сценарий 4: Создание связей между узлами (User)

**Цель:** Связать новую теорию с существующими концепциями и экспериментами.

**Шаги:**
1. После публикации теории открыт узел
2. Нажимает "Добавить связь"
3. Открывается модальное окно:
   - Выбирает тип связи: "Выводится из"
   - Ищет целевой узел: "Постулаты эфирной среды"
   - Добавляет описание связи (опционально)
   - Устанавливает confidence: 0.8
4. Сохраняет → связь появляется на графе
5. Добавляет еще связи:
   - "Поддерживается" → "Эксперимент Майкельсона-Морли (альтернативная интерпретация)"
   - "Противоречит" → "Теория относительности Эйнштейна"
6. Видит обновленный граф с новыми связями
7. Может кликнуть на любую связь:
   - Посмотреть детали
   - Отредактировать
   - Удалить

**Особенности:**
- Автодополнение при поиске узлов
- Предварительный просмотр целевого узла
- Визуальная обратная связь на графе
- Валидация: запрет self-loops

**Ключевые экраны:**
- Модальное окно создания связи
- Обновленный граф связей

---

### Сценарий 5: Создание нового домена (User → Domain Owner)

**Цель:** Создать домен "Торсионные поля" с собственными типами узлов.

**Шаги:**
1. Переходит в "Мои домены"
2. Нажимает "Создать домен"
3. Заполняет форму:
   - Название: "Торсионные поля"
   - Slug: torsion-fields
   - Описание: "Исследование торсионных полей..."
   - Видимость: Публичный ✅
   - Иконка: выбирает из библиотеки или загружает
   - Цвет: #9C27B0
4. Сохраняет домен
5. Автоматически создаются базовые типы узлов:
   - Теория
   - Эксперимент
   - Концепция
   - Аксиома
   - Постулат
6. Может настроить типы узлов:
   - Редактировать существующие
   - Добавить новые: "Наблюдение", "Гипотеза"
   - Для каждого типа: название, иконка, цвет, порядок
7. Настраивает типы связей:
   - По умолчанию: Поддерживает, Противоречит, Выводится из
   - Добавляет специфичные: "Индуцирует торсионное поле"
8. Приглашает соавторов (если нужно):
   - Вводит email
   - Выбирает права: Collaborator
   - Отправляет приглашение

**Ключевые экраны:**
- Форма создания домена
- Настройки домена (типы узлов, типы связей)
- Управление соавторами

---

### Сценарий 6: Совместная работа над доменом (Collaborator)

**Цель:** Соавтор дополняет домен новыми узлами.

**Шаги:**
1. Получает приглашение на email
2. Переходит по ссылке → авторизуется
3. Принимает приглашение
4. Видит домен в разделе "Доступные домены"
5. Может создавать узлы в этом домене
6. Может редактировать существующие узлы домена
7. Не может:
   - Удалить домен
   - Изменить настройки домена
   - Управлять правами доступа

**Особенности:**
- Отображение роли на страницах домена
- История изменений (опционально для MVP)

---

### Сценарий 7: Администрирование (Admin)

**Цель:** Модерация контента, управление платформой.

**Действия:**
1. Переходит в Admin Panel
2. Видит дашборд:
   - Статистика: количество доменов, узлов, пользователей
   - Последние узлы (для модерации)
   - Жалобы пользователей (future)
3. Может:
   - Просматривать все домены
   - Редактировать/удалять любые узлы
   - Управлять пользователями
   - Изменять глобальные настройки
   - Просматривать логи

**Ключевые экраны:**
- Admin Dashboard
- Список всех доменов/узлов
- Модерация контента

---

## Структура страниц

### 1. Главная страница (`/`)

**Для анонимных пользователей:**
- Hero секция:
  - Заголовок: "Исследуйте альтернативные теории физики"
  - Подзаголовок: "Интерактивный граф знаний"
  - Поиск (крупный)
  - CTA: "Начать исследование" → переход к доменам
- Секция "Популярные домены" (3-4 карточки)
- Секция "Недавно добавленные теории" (список узлов)
- Секция "Как это работает" (3 шага с иконками)
- Footer: О проекте, Контакты, Документация

**Для авторизованных пользователей:**
- Персонализированный дашборд:
  - Мои домены (карточки)
  - Мои узлы (последние 5)
  - Рекомендации (похожие узлы)
  - Быстрые действия: "Создать узел", "Создать домен"

---

### 2. Страница домена (`/domains/:slug`)

**Структура:**
- Header домена:
  - Иконка и название
  - Описание
  - Статистика: количество узлов, связей
  - Кнопки: "Следить" (future), "Поделиться"
- Фильтры:
  - По типу узла (табы или dropdown)
  - По тегам
  - По статусу (для владельца)
- Список узлов:
  - Карточки с превью
  - Сортировка: по дате, по рейтингу, по связям
- Визуализация домена:
  - Кнопка "Показать граф домена" → полноэкранный граф

**Права:**
- Owner: видит кнопку "Настройки домена"
- Collaborator: видит индикатор роли
- Guest: только просмотр опубликованных узлов

---

### 3. Страница узла (`/nodes/:slug`)

**Структура:**

**Header:**
- Breadcrumbs: Домен → Тип узла → Узел
- Заголовок (h1)
- Метаданные:
  - Тип узла (бейдж с цветом)
  - Автор
  - Дата публикации
  - Время чтения
- Теги (кликабельные)
- Действия (для автора):
  - Редактировать
  - Удалить
  - Изменить статус

**Основной контент:**
- Обложка (если есть)
- EditorJS контент:
  - Заголовки
  - Параграфы
  - Изображения
  - Списки
  - Код (формулы LaTeX)
  - Цитаты

**Боковая панель (sidebar):**
- Рейтинги:
  - Coherence (согласованность)
  - Consistency (последовательность)
  - Connectivity (связанность)
- Кнопка "Оценить" (для User)
- Статистика:
  - Просмотры
  - Количество связей
- Связанные узлы (рекомендации)

**Секция связей:**
- Визуализация графа (компактная):
  - Текущий узел в центре
  - Связанные узлы вокруг
  - Интерактивность: клик → переход к узлу
- Две колонки:
  - **Исходящие связи (Outgoing):**
    - Список: тип связи → целевой узел
  - **Входящие связи (Incoming):**
    - Список: исходный узел → тип связи
- Кнопка "Добавить связь" (для автора)
- Кнопка "Развернуть граф" → полноэкранная визуализация

**Комментарии:**
- Интеграция Disqus
- Счетчик комментариев в header

**Footer узла:**
- Кнопка "Поделиться" (социальные сети)
- История изменений (future)

---

### 4. Форма создания/редактирования узла (`/nodes/new`, `/nodes/:id/edit`)

**Структура:**

**Левая панель (основная форма):**
- Заголовок (input)
- Slug (auto-generated, editable)
- Выбор домена (dropdown)
- Выбор типа узла (dropdown с иконками)
- EditorJS редактор:
  - Toolbar: заголовки, параграфы, списки, изображения, код, цитаты
  - Плагины: LaTeX, встраивание видео (future)
- Теги (input с автодополнением)
- Пользовательские поля (data):
  - Динамически генерируются на основе schema типа узла
  - Например, для "Эксперимент": дата, методология

**Правая панель (метаданные):**
- Обложка (загрузка изображения)
- Краткое описание (textarea)
- Статус:
  - Черновик (draft)
  - Опубликован (published)
  - Архивирован (archived)
- Время чтения (auto-calculated или manual)

**Действия:**
- Сохранить как черновик
- Предпросмотр
- Опубликовать
- Отмена

**UX:**
- Автосохранение каждые 30 секунд
- Предупреждение при выходе без сохранения
- Валидация полей в реальном времени

---

### 5. Граф-визуализация (полноэкранная)

**Режимы:**
1. **Граф узла** (`/nodes/:slug/graph`)
   - Центральный узел + связи
   - Глубина: 1-2 уровня
2. **Граф домена** (`/domains/:slug/graph`)
   - Все узлы домена
   - Все связи

**Элементы интерфейса:**
- Toolbar:
  - Зум +/- (или mouse wheel)
  - Fit to screen
  - Фильтры:
    - По типу узла (чекбоксы)
    - По типу связи (чекбоксы)
  - Настройки визуализации:
    - Force-directed layout / Hierarchical / Circular
    - Размер узлов: по связям / по рейтингу
- Узлы:
  - Цвет по типу узла
  - Размер по количеству связей
  - Клик → переход к узлу
  - Hover → tooltip (название, тип, краткое описание)
- Связи:
  - Цвет по типу связи
  - Толщина по весу (weight)
  - Стрелки для направленных связей
  - Hover → tooltip (тип связи, описание)
- Легенда:
  - Типы узлов (цвета)
  - Типы связей (цвета)
- Кнопка "Закрыть" → возврат на страницу узла/домена

**Технологии:**
- D3.js или Cytoscape.js для визуализации
- WebGL для больших графов (1000+ узлов)

---

### 6. Поиск (`/search?q=...`)

**Структура:**
- Строка поиска (крупная)
- Фильтры:
  - По доменам (чекбоксы)
  - По типам узлов (чекбоксы)
  - По тегам (мультиселект)
  - По датам
- Результаты:
  - Карточки узлов
  - Подсветка совпадений (highlight)
  - Сортировка: по релевантности, по дате
- Пагинация

**Поиск использует:**
- PostgreSQL `pg_trgm` для fuzzy search
- GIN индексы на `title` и `excerpt`

---

### 7. Dashboard пользователя (`/dashboard`)

**Секции:**

**Мои домены:**
- Карточки доменов
- Кнопка "Создать домен"

**Мои узлы:**
- Табы: Все / Черновики / Опубликованные / Архивированные
- Список узлов с действиями (редактировать, удалить)
- Кнопка "Создать узел"

**Домены с доступом:**
- Список доменов, где пользователь - Collaborator
- Индикатор роли

**Статистика:**
- Количество узлов
- Количество связей
- Просмотры (future)

---

### 8. Настройки домена (`/domains/:slug/settings`)

**Доступно:** Owner

**Вкладки:**

**1. Основные настройки:**
- Название, slug, описание
- Иконка, цвет
- Видимость: публичный/приватный
- Статус: активный/архивированный

**2. Типы узлов:**
- Список типов узлов
- Действия: добавить, редактировать, удалить
- Для каждого типа:
  - Название, slug, описание
  - Иконка, цвет
  - Порядок отображения
  - JSON Schema (для пользовательских полей)

**3. Типы связей:**
- Список типов связей
- Действия: добавить, редактировать, удалить
- Для каждого типа:
  - Название, slug, описание
  - Семантический тип (supports, contradicts, derives_from, etc.)
  - Иконка, цвет
  - Вес (weight)
  - Направленность

**4. Соавторы:**
- Список соавторов с ролями
- Кнопка "Пригласить соавтора"
- Действия: изменить роль, удалить

**5. Опасная зона:**
- Удалить домен (с подтверждением)

---

## Навигация и UX паттерны

### Главная навигация (Header)

**Для анонимных:**
- Logo (ссылка на главную)
- Домены
- Поиск (глобальный)
- Войти (Google OAuth)

**Для авторизованных:**
- Logo
- Домены
- Поиск
- Создать (dropdown):
  - Создать узел
  - Создать домен
- Уведомления (future)
- Профиль (dropdown):
  - Мой профиль
  - Dashboard
  - Настройки
  - Выйти

**Для Admin:**
- Дополнительно: Admin Panel

---

### Навигация по графу (Graph Navigation)

**Паттерны:**
1. **Breadcrumbs:**
   - Всегда показываем путь: Домен → Тип → Узел
   - Кликабельные элементы

2. **Граф-навигация:**
   - Клик по узлу в графе → переход на страницу узла
   - Клик по связи → показать детали связи
   - Контекстное меню (right-click):
     - Открыть в новой вкладке
     - Показать входящие связи
     - Показать исходящие связи

3. **История навигации:**
   - "Недавно просмотренные" в sidebar (для User)
   - Кнопка "Назад к графу" при навигации по узлам

---

### Модальные окна

**Создание связи:**
- Открывается поверх страницы узла
- Шаги:
  1. Выбрать тип связи (визуальные карточки)
  2. Найти целевой узел (поиск с автодополнением)
  3. Добавить описание (textarea)
  4. Установить метаданные (confidence, references)
- Предпросмотр связи на мини-графе
- Кнопки: Создать, Отмена

**Предпросмотр узла:**
- Открывается при наведении на связь в графе
- Показывает: название, тип, краткое описание, обложку
- Кнопка: "Перейти к узлу"

**Оценка узла (Rating):**
- 3 слайдера: Coherence, Consistency, Connectivity
- Краткое объяснение каждого критерия
- Кнопки: Сохранить, Отмена

---

### Обратная связь (Feedback)

**Индикаторы загрузки:**
- Скелетоны (skeleton screens) для карточек
- Спиннеры для действий (сохранение, удаление)
- Прогресс-бар для загрузки графа

**Уведомления (Toasts):**
- Успех: зеленый, "Узел создан успешно"
- Ошибка: красный, "Не удалось сохранить"
- Предупреждение: желтый, "Связь уже существует"
- Инфо: синий, "Автосохранение..."

**Подтверждения:**
- Удаление узла: "Вы уверены? Это действие нельзя отменить."
- Удаление домена: "Введите название домена для подтверждения"
- Выход без сохранения: "У вас есть несохраненные изменения"

---

### Адаптивность (Responsive)

**Desktop (1920px+):**
- Sidebar с метаданными
- Граф на 50-70% экрана
- Две колонки для списков

**Laptop (1280-1920px):**
- Стандартный layout
- Граф на 50% экрана

**Tablet (768-1280px):**
- Sidebar сворачивается в аккордеон
- Граф на весь экран (кнопка для открытия)
- Одна колонка для списков

**Mobile (до 768px):**
- Упрощенный граф (список связей вместо визуализации)
- Навигация через hamburger menu
- Все в одну колонку
- Мобильная версия EditorJS

---

### Доступность (Accessibility)

**Обязательно:**
- Семантическая HTML разметка
- ARIA атрибуты для интерактивных элементов
- Клавиатурная навигация (Tab, Enter, Esc)
- Цветовые контрасты (WCAG AA)
- Alt-тексты для изображений
- Фокус-индикаторы

**Граф:**
- Альтернативный список связей для screen readers
- Клавиатурное управление графом (стрелки для навигации)

---

## Приоритеты разработки

### MVP (Minimum Viable Product)

**Phase 1: Core Functionality (4-6 недель)**

**Должно быть:**
1. ✅ Аутентификация (Google OAuth)
2. ✅ Создание/редактирование узлов (EditorJS)
3. ✅ Создание связей между узлами
4. ✅ Базовая визуализация графа (D3.js)
5. ✅ Страница узла с контентом и связями
6. ✅ Поиск узлов
7. ✅ Домены (CRUD)

**Можно отложить:**
- ❌ Рейтинговая система
- ❌ Комментарии (Disqus) - добавить позже
- ❌ Соавторы доменов
- ❌ Уведомления
- ❌ История изменений

---

### Phase 2: Enhanced Features (3-4 недели)

1. ✅ Рейтинговая система (coherence, consistency, connectivity)
2. ✅ Интеграция Disqus для комментариев
3. ✅ Соавторы доменов (права доступа)
4. ✅ Расширенная визуализация графа (фильтры, layouts)
5. ✅ Пользовательские поля (JSON Schema для типов узлов)

---

### Phase 3: Advanced Features (4-6 недель)

1. ✅ Уведомления (real-time через WebSockets)
2. ✅ История изменений узлов (versioning)
3. ✅ Экспорт графа (PNG, SVG, JSON)
4. ✅ Статистика и аналитика
5. ✅ SEO оптимизация
6. ✅ Admin Panel
7. ✅ Модерация контента

---

### Phase 4: Advanced Graph Features (3-4 недели)

1. ✅ Алгоритмы на графе:
   - Shortest path между узлами
   - Community detection (кластеры)
   - PageRank для узлов
2. ✅ Продвинутые фильтры:
   - Фильтрация по рейтингам
   - Фильтрация по глубине связей
3. ✅ Рекомендательная система (похожие узлы)

---

## Технический стек (рекомендации)

### Frontend

**Core:**
- **React 19** - UI библиотека
- **TypeScript** - типизация
- **Vite** - сборщик
- **React Router** - навигация

**State Management:**
- **TanStack Query (React Query)** - для API запросов и кеширования
- **Zustand** или **Context API** - для глобального состояния

**UI Components:**
- **Tailwind CSS** - стили
- **shadcn/ui** или **Ant Design** - компоненты
- **Framer Motion** - анимации

**Graph Visualization:**
- **D3.js** - для кастомных графов (MVP)
- **Cytoscape.js** - альтернатива с готовыми layouts
- **React Flow** - для простых flow-графов

**Rich Text Editor:**
- **EditorJS** - блочный редактор (уже спроектирован в backend)
- Плагины: image, code, LaTeX

**Forms:**
- **React Hook Form** - управление формами
- **Zod** - валидация схем

**Authentication:**
- **React OAuth** - обертка для Google OAuth

**Comments:**
- **Disqus** - встраиваемые комментарии

---

## Метрики успеха

### Пользовательские метрики:

1. **Engagement:**
   - Время на сайте > 5 минут
   - Глубина навигации по графу > 3 узлов за сессию
   - Возврат пользователей > 30%

2. **Создание контента:**
   - Количество созданных узлов/неделю
   - Количество связей/неделю
   - Количество новых доменов/месяц

3. **Качество контента:**
   - Средний рейтинг узлов > 0.7
   - Количество комментариев на узел > 2

4. **Поиск:**
   - CTR результатов поиска > 40%
   - Refinement rate (повторные поиски) < 30%

---

## Заключение

Этот документ описывает полный путь пользователей платформы Knowledge Graph. Ключевые принципы:

1. **Простота для новичков:** Гость может сразу начать исследование без регистрации
2. **Мощь для экспертов:** Продвинутые пользователи могут строить сложные графы знаний
3. **Визуализация в центре:** Граф - основной способ навигации и понимания связей
4. **Гибкость:** Пользователи могут создавать собственные домены с кастомными типами
5. **Сообщество:** Комментарии и совместная работа

Следующий шаг - создание прототипов (Figma) основных экранов на основе этого документа.